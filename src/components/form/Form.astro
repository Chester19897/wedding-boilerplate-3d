<div class="container px-4">
  <div
    class="relative md:max-w-[650px] max-w-[570px] p-5 shadow-[0_2px_16.8px_3.2px_rgba(0,0,0,.08)] bg-[#fff] rounded-[322px] my-0 mx-auto"
  >
    <div
      class="form-wrapper md:py-[50px] md:px-[60px] py-[50px] px-[15px] relative border border-solid border-[#a3888c] rounded-[322px]"
    >
      <div class="form-attending">
        <div>
          <div class="form-title mb-8 text-center">
            <h2
              class="before:content-['']
                before:absolute
                before:left-[50%]
                before:bottom-[-20%]
                before:w-[70%]
                before:h-px
                before:translate-x-[-50%] before:bg-[#e7e7e7] font-medium text-[#a3888c] inline-block pb-5 relative mt-2 md:text-[50px]
                after:content-['']
                after:absolute
                after:left-[-10%]
                after:bottom-0
                after:w-[120%]
                after:h-px
                after:bg-[#e7e7e7]
                text-[22px]"
            >
              Lời mời
            </h2>
          </div>
        </div>
        <div>
          <p class="text-center">
            Tới dự bữa tiệc chung vui cùng gia đình chúng tôi mừng <br />
             Lễ Thành Hôn
          </p>
          <br />
          <p class="flex justify-center align-middle mt-1 name-user">
            Hoàng Việt & Bích Ngọc
          </p>

          <!-- <p class="flex justify-center align-middle">and</p>
          <p class="flex justify-center align-middle mb-2 name-user">
            Bích Ngọc
          </p> -->
          <br />
          <p class="flex justify-center align-middle">
            Bữa cơm thân mật sẽ diễn ra vào lúc 10h00, Thứ Bảy
          </p>
          <b class="flex justify-center align-middle"> 02 . 12 . 2023.</b>
          <p class="flex justify-center align-middle mb-2">
            (Tức Ngày 20 tháng 10 năm Quý Mão)
          </p>

          <p class="flex justify-center align-middle mb-2">
            TẠI: NHÀ VĂN HÓA THÔN YÊN QUÁN
          </p>
          <p class="flex justify-center align-middle mb-2">
            Bình Định, Yên Lạc, Vĩnh Phúc
          </p>
          <p class="flex justify-center align-middle mb-2">
            Sự hiện diện của Quý vị là niềm vinh hạnh cho gia đình chúng tôi
          </p>
        </div>
        <div class="mt-4">
          <h3 class="text-3xl text-[#837A7A]">Xác nhận tham gia</h3>
        </div>
        <div>
          <input
            class="block w-full mb-5 border-b border-solid border-[#cde0ef] bg-transparent text-[#787878] pl-0 text-xl rounded-0 h-10"
            placeholder="Họ tên"
            id="nameInput"
          />
          <p id="hoten" class="text-xl h-10"></p>
        </div>
        <div class="form-input">
          <input
            class="block w-full mb-5 border-b border-solid border-[#cde0ef] bg-transparent text-[#787878] pl-0 text-xl rounded-0 h-10"
            placeholder="Số điện thoại"
            id="phone"
          />
        </div>
        <div class="form-input flex justify-between">
          <label
            for="countries"
            class="block mb-2 text-sm font-medium text-left text-gray-900 dark:text-white text-[#787272] pl-0 text-xl rounded-0"
            >Địa điểm tổ chức cưới
          </label>
          <select
            class="block w-[200px] mb-5 b text-[#787878] pl-0 text-xl rounded-0 border-none focus:border-none pt-0"
            id="location"
          >
            <option value="VINHPHUC">VĨNH PHÚC</option>
            <option value="HATINH">HÀ TĨNH</option>
          </select>
        </div>
        <div class="submit text-center">
          <button
            class="border rounded-full border-transparent p-3 bg-orange-200"
            id="buttonsubmit"
          >
            Gửi thông tin
          </button>
        </div>
      </div>
      <div
        class="hidden md:block md:absolute md:left-[-30%] md:bottom-[-10%] md:z-[-1]"
      >
        <picture>
          <source srcset="/assets/vector-2.webp" type="image/webp" />
          <img src="/src/assets/vector-2.webp" />
        </picture>
      </div>
      <div
        class="hidden md:block md:absolute md:right-[-26%] md:top-[-3%] md:z-[-1]"
      >
        <picture>
          <source srcset="/assets/vector-1.webp" type="image/webp" />
          <img src="/src/assets/vector-1.webp" />
        </picture>
      </div>
    </div>
  </div>
</div>
<style>
  .name-user {
    font-family: 'Italianno', sans-serif !important;
    font-size: 40px !important;
    font-weight: 400;
    color: #837a7a !important;
  }
</style>
<script is:inline src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
<script is:inline>
  var arrId = window.location.search.split('=')
  if (arrId.length === 1 || arrId[1] === '') {
    $('#hoten').hide()
    $('#nameInput').show()
  } else {
    $('#hoten').show()
    $('#nameInput').hide()
  }
  async function fetchData() {
    var name = ''
    const response = await fetch(
      'https://htpliweeuekelvokcjwp.supabase.co/graphql/v1',
      {
        method: 'POST',

        headers: {
          'Content-Type': 'application/json',
          apikey:
            'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh0cGxpd2VldWVrZWx2b2tjandwIiwicm9sZSI6ImFub24iLCJpYXQiOjE2OTk2MTE4NjEsImV4cCI6MjAxNTE4Nzg2MX0.fw5lrOvPtgRVYyzP1qYL-5b0uRxQqjWqOpkTv1htmFs',
          Authorization: `Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh0cGxpd2VldWVrZWx2b2tjandwIiwicm9sZSI6ImFub24iLCJpYXQiOjE2OTk2MTE4NjEsImV4cCI6MjAxNTE4Nzg2MX0.fw5lrOvPtgRVYyzP1qYL-5b0uRxQqjWqOpkTv1htmFs`
        },

        body: JSON.stringify({
          query: `query getCustomerById($id:UUID){
            customersCollection(filter:{id: {eq:$id}}) {
              edges {
                node {
                  id
                  isAttendace
                  name
                }
              }
            }
          }`,
          variables: {
            id: arrId[1]
          }
        })
      }
    )
    const data = await response.json()

    name = data.data.customersCollection?.edges[0]?.node?.name
    $('#hoten').html(data.data.customersCollection?.edges[0]?.node?.name)
  }

  const ressult = fetchData()

  $('#buttonsubmit').on('click', async () => {
    try {
      const hotenValue = $('#hoten').html()
      const data = await fetch(
        'https://htpliweeuekelvokcjwp.supabase.co/graphql/v1',
        {
          method: 'POST',

          headers: {
            'Content-Type': 'application/json',
            apikey:
              'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh0cGxpd2VldWVrZWx2b2tjandwIiwicm9sZSI6ImFub24iLCJpYXQiOjE2OTk2MTE4NjEsImV4cCI6MjAxNTE4Nzg2MX0.fw5lrOvPtgRVYyzP1qYL-5b0uRxQqjWqOpkTv1htmFs',
            Authorization: `Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh0cGxpd2VldWVrZWx2b2tjandwIiwicm9sZSI6ImFub24iLCJpYXQiOjE2OTk2MTE4NjEsImV4cCI6MjAxNTE4Nzg2MX0.fw5lrOvPtgRVYyzP1qYL-5b0uRxQqjWqOpkTv1htmFs`
          },

          body: JSON.stringify({
            query: `mutation updateOneCustomers(
                  $id:UUID,
                  $location:Location,
                  $isAttendance:Boolean,
                  $wish:String
                ){
                  updatecustomersCollection(
                    filter:{id: {eq:$id}},
                    set:{
                      isAttendace:$isAttendance,
                      location:$location,
                      wish:$wish
                    }
                  ) {
                    affectedCount
                    records{
                      id
                      nodeId
                      relation
                      location
                      isAttendace
                      wish
                    }
                  }
                }`,
            variables: {
              id: arrId[1],
              location: $('#location').val(),
              isAttendance: true,
              phone: $('#phone').val(),
              name: hotenValue !== '' ? hotenValue : $('#nameInput').val(),
              wish: ''
            }
          })
        }
      )
      const result = await data.json()
      if (result.data.updatecustomersCollection.affectedCount !== 0) {
        Toastify({
          text: 'Thông tin được gửi thành công',
          duration: 1000,
          destination: 'https://github.com/apvarun/toastify-js',
          newWindow: true,
          gravity: 'top', // `top` or `bottom`
          position: 'right', // `left`, `center` or `right`
          stopOnFocus: true, // Prevents dismissing of toast on hover
          style: {
            background: 'linear-gradient(to right, #00b09b, #96c93d)'
          },
          onClick: function () {} // Callback after click
        }).showToast()
      }
    } catch (error) {
      console.log('error', error)
    }
  })
</script>
